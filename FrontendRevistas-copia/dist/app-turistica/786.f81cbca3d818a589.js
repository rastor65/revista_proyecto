"use strict";(self.webpackChunkAppTuristica=self.webpackChunkAppTuristica||[]).push([[786],{8786:(D,u,c)=>{c.r(u),c.d(u,{RolesRecursosModule:()=>V});var a=c(9808),d=c(1813),e=c(7587),m=c(3662),f=c(4765),g=c(520),R=c(2340);let _=(()=>{class t{constructor(o){this.http=o,this.API_URI=R.N.API_URI,this.base_recursos=`${this.API_URI}/resources/`,this.base_recursos_rol=`${this.API_URI}/resourcesr/`}getResources(){return this.http.get(this.base_recursos)}createResource(o){return this.http.post(this.base_recursos,o)}updateResource(o,r){return this.http.put(`${this.base_recursos}${o}/`,r)}deleteResource(o){return this.http.delete(`${this.base_recursos}${o}/`)}assignResourceToRole(o,r){return this.http.post(this.base_recursos_rol,{resource:o,role:r,status:!0})}deleteResourceFromRole(o){const r=`${this.base_recursos_rol}/resourcesr/${o}`,s=new g.WM({"Content-Type":"application/json"});return this.http.delete(r,{headers:s})}getAssignedRolesToResources(){return this.http.get(`${this.base_recursos_rol}`)}}return t.\u0275fac=function(o){return new(o||t)(e.LFG(g.eN))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var x=c(9783),l=c(3075),p=c(1497);function C(t,n){if(1&t&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&t){const o=n.$implicit;e.Q6J("value",o.id),e.xp6(1),e.Oqu(o.name)}}function b(t,n){if(1&t&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&t){const o=n.$implicit;e.Q6J("value",o.id),e.xp6(1),e.Oqu(o.titulo)}}function Z(t,n){if(1&t&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&t){const o=n.$implicit;e.xp6(1),e.Oqu(o.name)}}function v(t,n){if(1&t&&(e.TgZ(0,"td"),e.TgZ(1,"label",16),e._UZ(2,"input",17),e._UZ(3,"span",18),e.qZA(),e.qZA()),2&t){const o=n.$implicit,r=e.oxw().$implicit,s=e.oxw();e.xp6(2),e.Q6J("checked",s.hasAccess(o.id,r.id))}}function T(t,n){if(1&t&&(e.TgZ(0,"td"),e.TgZ(1,"label",16),e._UZ(2,"input",17),e._UZ(3,"span",18),e.qZA(),e.qZA()),2&t){const o=n.$implicit,r=e.oxw().$implicit,s=e.oxw(2);e.xp6(2),e.Q6J("checked",s.hasAccess(o.id,r.id))}}function M(t,n){if(1&t&&(e.TgZ(0,"td"),e.TgZ(1,"label",16),e._UZ(2,"input",17),e._UZ(3,"span",18),e.qZA(),e.qZA()),2&t){const o=n.$implicit,r=e.oxw().$implicit,s=e.oxw(3);e.xp6(2),e.Q6J("checked",s.hasAccess(o.id,r.id))}}const O=function(){return{"grandchild-row":!0}};function A(t,n){if(1&t&&(e.ynx(0),e.TgZ(1,"tr",15),e.TgZ(2,"td"),e._uU(3),e.qZA(),e.YNc(4,M,4,1,"td",13),e.qZA(),e.BQk()),2&t){const o=n.$implicit,r=e.oxw(3);e.xp6(1),e.Q6J("ngClass",e.DdM(3,O)),e.xp6(2),e.Oqu(o.titulo),e.xp6(1),e.Q6J("ngForOf",r.roles)}}const y=function(){return{"child-row":!0}};function P(t,n){if(1&t&&(e.ynx(0),e.TgZ(1,"tr",15),e.TgZ(2,"td"),e._uU(3),e.qZA(),e.YNc(4,T,4,1,"td",13),e.qZA(),e.YNc(5,A,5,4,"ng-container",13),e.BQk()),2&t){const o=n.$implicit,r=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.DdM(4,y)),e.xp6(2),e.Oqu(o.titulo),e.xp6(1),e.Q6J("ngForOf",r.roles),e.xp6(1),e.Q6J("ngForOf",o.children)}}const U=function(){return{row:!0}};function J(t,n){if(1&t&&(e.ynx(0),e.TgZ(1,"tr",15),e.TgZ(2,"td"),e._uU(3),e.qZA(),e.YNc(4,v,4,1,"td",13),e.qZA(),e.YNc(5,P,6,5,"ng-container",13),e.BQk()),2&t){const o=n.$implicit,r=e.oxw();e.xp6(1),e.Q6J("ngClass",e.DdM(4,U)),e.xp6(2),e.Oqu(o.titulo),e.xp6(1),e.Q6J("ngForOf",r.roles),e.xp6(1),e.Q6J("ngForOf",o.children)}}const S=function(){return{top:"80px"}},Q=[{path:"crear",component:(()=>{class t{constructor(o,r,s,i){this.recursosService=o,this.rolesService=r,this.recursosRolesService=s,this.messageService=i,this.roles=[],this.resources=[],this.selectedRole=0,this.selectedResource=0,this.assignedRolesToResources={}}ngOnInit(){this.cargarRolesRecursos()}cargarRolesRecursos(){this.rolesService.getRoles().subscribe(o=>{this.roles=o}),this.recursosService.getResources().subscribe(o=>{this.resources=this.buildResourceHierarchy(o),this.loadAssignedRolesToResources()})}agregarRecursoRol(){this.selectedRole&&this.selectedResource&&this.recursosRolesService.assignResourceToRole(this.selectedResource,this.selectedRole).subscribe(o=>{this.messageService.add({severity:"success",summary:"\xc9xito",detail:"Recurso agregado al rol."}),this.cargarRolesRecursos()},o=>{console.error("Error del servidor:",o),this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo agregar el recurso al rol."})})}eliminarRecursoRol(o){confirm("\xbfEst\xe1s seguro de que deseas eliminar esta relaci\xf3n?")&&this.recursosRolesService.deleteResourceFromRole(o).subscribe(r=>{this.messageService.add({severity:"success",summary:"\xc9xito",detail:"Relaci\xf3n eliminada."})},r=>{console.error("Error del servidor:",r),this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar la relaci\xf3n."})})}buildResourceHierarchy(o){const r={},s=[];return o.forEach(i=>{r[i.id]=i,i.children=[]}),o.forEach(i=>{if(0===i.id_padre)s.push(i);else{const h=r[i.id_padre];h&&h.children.push(i)}}),s}flattenResources(o){let r=[];for(const s of o)r.push(s),s.children&&s.children.length>0&&(r=r.concat(this.flattenResources(s.children)));return r}get flattenedResources(){return this.flattenResources(this.resources)}loadAssignedRolesToResources(){this.recursosRolesService.getAssignedRolesToResources().subscribe(o=>{for(const r of o)this.assignedRolesToResources[r.resource]||(this.assignedRolesToResources[r.resource]=[]),this.assignedRolesToResources[r.resource].push(r.role)})}hasAccess(o,r){var s;const i=null===(s=this.assignedRolesToResources)||void 0===s?void 0:s[r];return i&&i.includes(o)}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(m.D),e.Y36(f.f),e.Y36(_),e.Y36(x.ez))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-crear"]],decls:35,vars:10,consts:[[1,"recursos-title"],[1,"role-resource-container"],[3,"submit"],[1,"input-container"],["for","selectRole"],["id","selectRole","name","selectedRole",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","selectResource"],["id","selectResource","name","selectedResource",3,"ngModel","ngModelChange"],["type","submit"],[1,"table-container"],[1,"resource-role-table"],[3,"colSpan"],[4,"ngFor","ngForOf"],[3,"value"],[3,"ngClass"],[1,"custom-checkbox"],["type","checkbox",3,"checked"],[1,"custom-label"]],template:function(o,r){1&o&&(e._UZ(0,"br"),e._UZ(1,"br"),e._UZ(2,"br"),e._UZ(3,"br"),e.TgZ(4,"h2",0),e._uU(5,"Asignar recursos"),e.qZA(),e.TgZ(6,"div",1),e.TgZ(7,"form",2),e.NdJ("submit",function(){return r.agregarRecursoRol()}),e.TgZ(8,"div",3),e.TgZ(9,"label",4),e._uU(10,"Seleccionar un Rol:"),e.qZA(),e.TgZ(11,"select",5),e.NdJ("ngModelChange",function(i){return r.selectedRole=i}),e.YNc(12,C,2,2,"option",6),e.qZA(),e.qZA(),e.TgZ(13,"div",3),e.TgZ(14,"label",7),e._uU(15,"Seleccionar un Recurso:"),e.qZA(),e.TgZ(16,"select",8),e.NdJ("ngModelChange",function(i){return r.selectedResource=i}),e.YNc(17,b,2,2,"option",6),e.qZA(),e.qZA(),e.TgZ(18,"button",9),e._uU(19,"Asignar recurso"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(20,"div",10),e.TgZ(21,"table",11),e.TgZ(22,"thead"),e.TgZ(23,"tr"),e.TgZ(24,"th"),e._uU(25,"RECURSOS"),e.qZA(),e.TgZ(26,"th",12),e._uU(27,"ROLES"),e.qZA(),e.qZA(),e.TgZ(28,"tr"),e.TgZ(29,"th"),e._uU(30,"Titulo"),e.qZA(),e.YNc(31,Z,2,1,"th",13),e.qZA(),e.qZA(),e.TgZ(32,"tbody"),e.YNc(33,J,6,5,"ng-container",13),e.qZA(),e.qZA(),e.qZA(),e._UZ(34,"p-toast")),2&o&&(e.xp6(11),e.Q6J("ngModel",r.selectedRole),e.xp6(1),e.Q6J("ngForOf",r.roles),e.xp6(4),e.Q6J("ngModel",r.selectedResource),e.xp6(1),e.Q6J("ngForOf",r.flattenedResources),e.xp6(9),e.Q6J("colSpan",r.roles.length),e.xp6(5),e.Q6J("ngForOf",r.roles),e.xp6(2),e.Q6J("ngForOf",r.resources),e.xp6(1),e.Akn(e.DdM(9,S)))},directives:[l._Y,l.JL,l.F,l.EJ,l.JJ,l.On,a.sg,l.YN,l.Kr,a.mk,p.FN],styles:['.recursos-title[_ngcontent-%COMP%]{font-size:36px;font-weight:700;margin-bottom:20px;text-align:center;color:#fa6357;text-transform:uppercase}.resources-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.role-resource-container[_ngcontent-%COMP%]{max-width:400px;margin:0 auto;padding:20px;border:1px solid #ccc;border-radius:5px;box-shadow:0 2px 4px #0000001a;background-color:#f9f9f9}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.input-container[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{font-weight:700}select[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ccc;border-radius:3px;font-size:14px}button[_ngcontent-%COMP%]{padding:10px 15px;background-color:#fa6357;color:#fff;border:none;border-radius:3px;font-size:16px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.table-container[_ngcontent-%COMP%]{margin-top:20px}.resource-role-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.resource-role-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .resource-role-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:center;border:1px solid #ccc}.resource-role-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:gray;color:#fff}.row[_ngcontent-%COMP%]{background-color:#ccc}.child-row[_ngcontent-%COMP%]{background-color:#e1e1e1}.grandchild-row[_ngcontent-%COMP%]{background-color:#f5f5f5}.custom-checkbox[_ngcontent-%COMP%]{position:relative;cursor:pointer}.custom-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{opacity:0;position:absolute}.custom-checkbox[_ngcontent-%COMP%]   .custom-label[_ngcontent-%COMP%]{position:relative;padding-left:25px;margin-bottom:10px;display:inline-block;font-size:16px;color:#333}.custom-checkbox[_ngcontent-%COMP%]   .custom-label[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:1px;width:18px;height:18px;border:2px solid #3498db;background-color:#fff;border-radius:4px}.custom-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-label[_ngcontent-%COMP%]:before{background-color:#3498db;border-color:#3498db}.custom-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-label[_ngcontent-%COMP%]:after{content:"\\2713";font-size:14px;position:absolute;top:0;left:4px;color:#fff}']}),t})()},{path:"ver",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-ver"]],decls:2,vars:0,template:function(o,r){1&o&&(e.TgZ(0,"h1"),e._uU(1,"VER"),e.qZA())},styles:[""]}),t})()}];let F=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[d.Bz.forChild(Q)],d.Bz]}),t})();var $=c(6697),q=c(845),k=c(9114),N=c(8061),Y=c(5315),E=c(1424),w=c(657),I=c(4036),z=c(2145),B=c(4297);let V=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[a.ez,F,I.kW,$.U$,q.hJ,k.D,N.Q,Y.S,E.j,l.u5,l.UX,w.kK,z.WN,p.EV,B.d]]}),t})()}}]);